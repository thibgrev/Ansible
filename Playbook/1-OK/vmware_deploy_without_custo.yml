- name: Deploiement de la VM nommee tg-aaaaaaaaaaaaaaa
  hosts: localhost
  gather_facts: no
  become: no
  vars:
    name_vm: tg-aaaaaaaaaaaaaaa
  vars_files:
    - ../../Vault/secret.yml

  tasks:

    - name: Clone the template
      community.vmware.vmware_guest:
        hostname: "{{ vault_vmware_hostname }}"
        username: "{{ vault_vmware_username }}"
        password: "{{ vault_vmware_password }}"
        validate_certs: False
        name: "{{ name_vm }}"
        template: tg-template-rhel_9
        datacenter: DCA
        folder: "/DCA/vm/Environnement/tgrevellec"
        state: poweredon
        cluster: "PROD"
        wait_for_ip_address: yes
        hardware:
          memory_mb: 4096
          num_cpus: 4
          num_cpu_cores_per_socket: 2
          hotadd_cpu: true
          hotadd_memory: true