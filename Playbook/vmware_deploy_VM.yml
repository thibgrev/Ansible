#Management of the need variables
- name: Management of the need variables
  hosts: localhost
  connection: local
  gather_facts: no
  tasks:
    - name: Check the "nomVM" variable
      fail:
        msg:
          - "Variable named nomVm is not defined and is mandatory"
          - "Variable named nomVM will be the name of the new VM deployed using this Playbook"
      when: nomVM is not defined

#Deployment and configure of a new VM Red Hat
- name: Deployment of "{{ nomVM }}"
  hosts: localhost
  connection: local
  gather_facts: no
  vars_files:
    #Vault file is needed because we use password and sensibled data stored in this document
    - ../vault_file.yml
  
  roles:
    #Role used to deply VM on VCenter target and configure Ansible connexion (SSH Key, add user...)
    - ../Roles/vmware_deploy_RHEL_and_configure_Ansible_connection
